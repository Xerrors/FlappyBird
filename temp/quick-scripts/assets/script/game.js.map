{"version":3,"sources":["game.js"],"names":["cc","Class","extends","Component","properties","ground","default","type","Node","bird","background","pillar1","pillar2","scoreDisplay","Label","button","jumpAudio","AudioClip","title","groundSpeed","birdFloatSpeed","fpscount","isGameOver","onLoad","active","node","firstTimeEnd","score","isprepared","y","Math","random","on","EventType","TOUCH_START","touchFunction","buttonClick","stopAllActions","jumpAction","setJumpAction","runAction","director","loadScene","jumpHeight","jumpDuraction","jumpRotation","dropTurnDuration","dropDownDuration","dropRotation","jumpUp","moveBy","v2","turnUp","rotateTo","jumpDown","turnDown","dropDown","moveTo","x","callback","callFunc","playJumpSound","spawn","sequence","audioEngine","playEffect","groundMove","birdFloat","pillarMove","getScore","string","scoreLine","isGameOverFun","touchLine","touchPillarTop1","abs","height","closePillar1","width","crushPillar1","touchPillarTop2","closePillar2","crushPillar2","gameOver","animBird","getComponent","Animation","stop","off","update","dt"],"mappings":"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","file":"game.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        ground:{\n            default: null,\n            type: cc.Node,\n        },\n\n        bird:{\n            default: null,\n            type: cc.Node,\n        },\n\n        background:{\n            default: null,\n            type: cc.Node,\n        },\n\n        pillar1:{\n            default: null,\n            type: cc.Node,\n        },\n        \n        pillar2:{\n            default: null,\n            type: cc.Node,\n        },\n\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n\n        button: {\n            default: null,\n            type: cc.Node,\n        },\n\n        jumpAudio: {\n            default: null,\n            type: cc.AudioClip,\n        },\n\n        title: {\n            default:null,\n            type: cc.Node,\n        },\n\n        // backGroundAudio: {\n        //     default: null,\n        //     type: cc.AudioClip,\n        // },\n        \n    \n        //地面移动的速度\n        groundSpeed: 10,\n        //小鸟在未开始游戏时，上下浮动的速度\n        birdFloatSpeed: 0.5,\n        //计算帧数\n        fpscount : 0,\n        //判断是否游戏结束\n        isGameOver : false,\n\n    },\n\n\n    onLoad: function() {\n        // 隐藏重新开始\n        this.button.active = false;\n        this.scoreDisplay.node.active = false;\n        this.title.active = true;\n\n        //判断结束的flag\n        this.firstTimeEnd = true;\n\n        //播放背景音乐\n        // this.current = cc.audioEngine.play(this.backGroundAudio, false, 1);\n\n        //初始化游戏的分数\n        this.score = 0;\n\n        //判断是否处于未开始游戏状态\n        this.bird.isprepared = false;\n        \n        //设置柱子的初始位置\n        this.pillar1.y = Math.random() * 700 - 280;\n        this.pillar2.y = Math.random() * 700 - 280;\n\n        //当屏幕被点击的时候\n        this.node.on(cc.Node.EventType.TOUCH_START,this.touchFunction, this);\n\n        //当 重新开始 按钮被点击时\n        this.button.on(\"click\",this.buttonClick,this);\n\n        \n        \n    },\n\n    touchFunction: function(){\n            // console.log( \"cc.Node.EventType.TOUCH_START\" );\n            //停止所有动作\n            this.bird.stopAllActions();\n\n            this.jumpAction = this.setJumpAction();\n            //游戏开始\n            this.bird.isprepared = true;\n            this.bird.runAction(this.jumpAction);\n    },\n\n    buttonClick: function(){\n        cc.director.loadScene('game');\n    },\n\n    setJumpAction: function () {\n        this.bird.jumpHeight = 100;\n        this.bird.jumpDuraction = 0.25;\n        this.bird.jumpRotation = -15;\n        this.bird.dropTurnDuration = 0.2;\n        this.bird.dropDownDuration = 1.3;\n        this.bird.dropRotation = 90;\n\n        //动作列表，函数有待优化\n        var jumpUp = cc.moveBy(this.bird.jumpDuraction, cc.v2(0, this.bird.jumpHeight));\n        var turnUp = cc.rotateTo(0, -15);\n        var jumpDown = cc.moveBy(this.bird.jumpDuraction, cc.v2(0, -this.bird.jumpHeight));\n        var turnDown = cc.rotateTo(this.bird.dropTurnDuration, this.bird.dropRotation);\n        var dropDown = cc.moveTo((this.bird.y + 640) / 1280 * this.bird.dropDownDuration, this.bird.x, -512);\n\n        var callback = cc.callFunc(this.playJumpSound, this);\n\n        this.bird.spawn = cc.spawn(turnDown, dropDown);\n        return cc.sequence(turnUp, callback, jumpUp, jumpDown, this.bird.spawn);\n    },\n\n    playJumpSound: function () {\n        // 调用声音引擎播放声音\n        cc.audioEngine.playEffect(this.jumpAudio, false);\n    },\n   \n    groundMove: function(){\n        this.ground.x -= this.groundSpeed;\n        if(this.ground.x <= -420){\n            this.ground.x = -360;\n        }\n    },\n\n    birdFloat: function(){\n        if(this.fpscount % 40 < 20){\n            this.bird.y += this.birdFloatSpeed;\n        }\n        else{\n            this.bird.y -= this.birdFloatSpeed;\n        }\n        this.fpscount += 1;\n    },\n\n    pillarMove: function(){\n        this.pillar1.x -= this.groundSpeed;\n        this.pillar2.x -= this.groundSpeed;\n        \n        if(this.pillar1.x <= -430){\n            this.pillar1.x = 430;\n            this.pillar1.y = Math.random() * 700 - 280;\n        }\n\n        if(this.pillar2.x <= -430){\n            this.pillar2.x = 430;\n            this.pillar2.y = Math.random() * 700 - 280;\n        }\n\n        if(this.getScore()){\n            this.score += 1;\n            //更新 score 的文字\n            this.scoreDisplay.string = 'Score: ' + this.score;\n        }\n    },\n\n    getScore: function(){\n        var scoreLine = -135;\n\n        if(this.pillar1.x <= scoreLine && this.pillar1.x > (scoreLine - this.groundSpeed)){\n            return true;\n        }\n        if(this.pillar2.x <= scoreLine && this.pillar2.x > (scoreLine - this.groundSpeed)){\n            return true;\n        }\n    },\n\n    isGameOverFun: function(){\n        //判断是否碰到上下边界\n        var touchLine = this.bird.y <= -470 || this.bird.y >= 1000;\n\n        //判断是否撞到柱子\n        var touchPillarTop1 = Math.abs(this.bird.y - this.pillar1.y) > (this.pillar1.height / 2 - this.bird.height / 2);\n        var closePillar1    = Math.abs(this.pillar1.x - this.bird.x) < (this.bird.width / 2 + this.pillar1.width / 2);\n        var crushPillar1    = touchPillarTop1 && closePillar1;\n\n        var touchPillarTop2 = Math.abs(this.bird.y - this.pillar2.y) > (this.pillar1.height / 2 - this.bird.height / 2);\n        var closePillar2    = Math.abs(this.pillar2.x - this.bird.x) < (this.bird.width / 2 + this.pillar2.width / 2);\n        var crushPillar2    = touchPillarTop2 && closePillar2;\n\n        if(touchLine || crushPillar1 || crushPillar2 ){\n            return true;\n        }\n    },\n    gameOver: function(){\n        //获取小鸟的动画组件，并停止动画\n        var animBird = this.bird.getComponent(cc.Animation);\n        animBird.stop();\n\n        //关闭监听事件\n        this.node.off(cc.Node.EventType.TOUCH_START,this.touchFunction, this);\n\n        //停止所有动作，并重新加载界面\n        this.bird.stopAllActions();\n        // cc.audioEngine.stop(this.current);\n\n        var callback = cc.callFunc(function(){\n            //显示重新开始\n            this.button.active = true;\n        }, this);\n\n        var sequence = cc.sequence(this.bird.spawn, callback);\n        this.bird.runAction(sequence);\n    },\n\n    update: function(dt) {\n        //未开始时小鸟的浮动\n        if(this.bird.isprepared == false){\n            this.birdFloat();\n        }\n\n        //隐藏标题，现实记分板\n        if(this.bird.isprepared == true){\n            this.title.active = false;\n            this.scoreDisplay.node.active = true;\n        }\n        \n        //在游戏开始之后、结束之前，移动游戏中的柱子\n        if(this.bird.isprepared == true && this.isGameOver == false){\n            this.groundMove();\n            this.pillarMove();\n        }\n\n        //游戏结束\n        if(this.isGameOverFun()){\n            this.isGameOver = true;\n            \n            if(this.firstTimeEnd == true){\n                this.gameOver();\n                this.firstTimeEnd = false;\n            }\n        }\n    },\n});\n"]}