{"version":3,"sources":["../../../../assets/script/assets/script/game.js"],"names":["cc","Class","extends","Component","properties","ground","default","type","Node","bird","background","pillar1","pillar2","scoreDisplay","Label","button","title","backGroundAudio","AudioClip","jumpAudio","lastScore","bestScore","initData","active","node","fpscount","isprepared","isGameOver","firstTimeEnd","score","groundSpeed","birdFloatSpeed","current","audioEngine","play","y","Math","random","onLoad","on","EventType","TOUCH_START","touchFunction","buttonClick","stopAllActions","jumpAction","setJumpAction","runAction","director","loadScene","jumpHeight","jumpDuraction","jumpRotation","dropTurnDuration","dropDownDuration","dropRotation","dropDuration","height","jumpUp","moveBy","v2","turnUp","rotateTo","jumpDown","turnDown","dropDown","moveTo","x","callback","callFunc","playJumpSound","spawn","sequence","playEffect","groundMove","birdFloat","pillarMove","width","getScore","string","scoreLine","isGameOverFun","touchLine","touchPillarTop1","abs","closePillar1","crushPillar1","touchPillarTop2","closePillar2","crushPillar2","gameOver","animBird","getComponent","Animation","stop","setScore","off","console","log","sys","localStorage","getItem","setItem","update","dt"],"mappings":"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","file":"game.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        ground:{\n            default: null,\n            type: cc.Node,\n        },\n\n        bird:{\n            default: null,\n            type: cc.Node,\n        },\n\n        background:{\n            default: null,\n            type: cc.Node,\n        },\n\n        pillar1:{\n            default: null,\n            type: cc.Node,\n        },\n        \n        pillar2:{\n            default: null,\n            type: cc.Node,\n        },\n\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n\n        button: {\n            default: null,\n            type: cc.Node,\n        },\n\n        title: {\n            default:null,\n            type: cc.Node,\n        },\n\n        backGroundAudio: {\n            default: null,\n            type: cc.AudioClip,\n        },  \n\n        jumpAudio: {\n            default: null,\n            type: cc.AudioClip,\n        },\n\n        lastScore:{\n            default:null,\n            type:cc.Label,\n        },\n\n        bestScore:{\n            default:null,\n            type:cc.Label,\n        },\n        \n\n\n    },\n\n    initData: function(){\n        // 隐藏重新开始、记分板，显示标题\n        this.button.active = false;\n        this.scoreDisplay.node.active = false;\n        this.title.active = true;\n\n        // 初始化帧数\n        this.fpscount = 0;\n\n        // 判断是否处于未开始游戏状态\n        this.bird.isprepared = false;\n\n        // 判断是否游戏结束\n        this.isGameOver = false;\n\n        // 判断第一次结束的flag\n        this.firstTimeEnd = true;\n\n        // 初始化游戏的分数\n        this.score = 0;\n\n        // 地面以及柱子移动的速度\n        this.groundSpeed = 4;\n\n        // 小鸟在未开始游戏时，上下浮动的速度\n        this.birdFloatSpeed = 0.5;\n\n        //播放背景音乐\n        this.current = cc.audioEngine.play(this.backGroundAudio, true, 1);\n\n        //设置柱子的初始位置\n        this.pillar1.y = Math.random() * 700 - 280;\n        this.pillar2.y = Math.random() * 700 - 280;\n    },\n\n    onLoad: function() {\n        //初始化游戏数据\n        this.initData();\n        \n        //当屏幕被点击的时候\n        this.node.on(cc.Node.EventType.TOUCH_START,this.touchFunction, this);\n\n        //当 重新开始 按钮被点击时\n        this.button.on(\"click\",this.buttonClick,this);\n    },\n\n    touchFunction: function(){\n        //停止所有动作\n        this.bird.stopAllActions();\n\n        this.jumpAction = this.setJumpAction();\n        //游戏开始\n        this.bird.isprepared = true;\n        this.bird.runAction(this.jumpAction);\n    },\n\n    buttonClick: function(){\n        cc.director.loadScene('game');\n    },\n\n    setJumpAction: function () {\n        this.bird.jumpHeight = 120;\n        this.bird.jumpDuraction = 0.3;\n        this.bird.jumpRotation = -15;\n        this.bird.dropTurnDuration = 0.2;\n        this.bird.dropDownDuration = 1.3;\n        this.bird.dropRotation = 90;\n\n        var dropDuration = (this.bird.y + this.node.height / 2) / (this.node.height - this.ground.height) * this.bird.dropDownDuration;\n\n        //动作列表，函数有待优化\n        var jumpUp = cc.moveBy(this.bird.jumpDuraction, cc.v2(0, this.bird.jumpHeight));\n        var turnUp = cc.rotateTo(0, this.bird.jumpRotation);\n        var jumpDown = cc.moveBy(this.bird.jumpDuraction, cc.v2(0, -this.bird.jumpHeight));\n        var turnDown = cc.rotateTo(this.bird.dropTurnDuration, this.bird.dropRotation);\n        var dropDown = cc.moveTo(dropDuration, this.bird.x, this.ground.height - this.node.height / 2);\n\n        //动作的回执函数，即执行动作后播放音效，参考上手第一个小游戏的音效添加\n        var callback = cc.callFunc(this.playJumpSound, this);\n\n        // spawn 同时执行多个动作\n        this.bird.spawn = cc.spawn(turnDown, dropDown);\n\n        // sequence 按顺序执行多个动作\n        return cc.sequence(turnUp, callback, jumpUp, jumpDown, this.bird.spawn);\n    },\n\n    playJumpSound: function () {\n        // 调用声音引擎播放声音\n        cc.audioEngine.playEffect(this.jumpAudio, false);\n    },\n   \n    groundMove: function(){\n        this.ground.x -= this.groundSpeed;\n        if(this.ground.x <= -420){\n            this.ground.x = -360;\n        }\n    },\n\n    birdFloat: function(){\n        if(this.fpscount % 40 < 20){\n            this.bird.y += this.birdFloatSpeed;\n        }\n        else{\n            this.bird.y -= this.birdFloatSpeed;\n        }\n        this.fpscount += 1;\n    },\n\n    pillarMove: function(){\n        this.pillar1.x -= this.groundSpeed;\n        this.pillar2.x -= this.groundSpeed;\n        \n        if(this.pillar1.x <= -(this.node.width / 2 + this.pillar1.width / 2)){\n            this.pillar1.x = this.node.width / 2 + this.pillar1.width / 2;\n            this.pillar1.y = Math.random() * 700 - 280;\n        }\n\n        if(this.pillar2.x <= -(this.node.width / 2 + this.pillar1.width / 2)){\n            this.pillar2.x = (this.node.width / 2 + this.pillar1.width / 2);\n            this.pillar2.y = Math.random() * 700 - 280;\n        }\n\n        if(this.getScore()){\n            this.score += 1;\n            //更新 score 的文字\n            this.scoreDisplay.string = 'Score: ' + this.score;\n        }\n    },\n\n    getScore: function(){\n        var scoreLine = this.bird.x - (this.pillar1.width + this.bird.width) / 2;\n        \n        //判断是否得分\n        if(this.pillar1.x <= scoreLine && this.pillar1.x > (scoreLine - this.groundSpeed)){\n            return true;\n        }\n        if(this.pillar2.x <= scoreLine && this.pillar2.x > (scoreLine - this.groundSpeed)){\n            return true;\n        }\n    },\n\n    isGameOverFun: function(){\n        //判断是否碰到上下边界\n        var touchLine = this.bird.y <= -470 || this.bird.y >= 1000;\n\n        //判断是否撞到柱子\n        var touchPillarTop1 = Math.abs(this.bird.y - this.pillar1.y) > (this.pillar1.height / 2 - this.bird.height / 2);\n        var closePillar1    = Math.abs(this.pillar1.x - this.bird.x) < (this.bird.width / 2 + this.pillar1.width / 2);\n        var crushPillar1    = touchPillarTop1 && closePillar1;\n\n        var touchPillarTop2 = Math.abs(this.bird.y - this.pillar2.y) > (this.pillar1.height / 2 - this.bird.height / 2);\n        var closePillar2    = Math.abs(this.pillar2.x - this.bird.x) < (this.bird.width / 2 + this.pillar2.width / 2);\n        var crushPillar2    = touchPillarTop2 && closePillar2;\n\n        if(touchLine || crushPillar1 || crushPillar2 ){\n            return true;\n        }\n    },\n    gameOver: function(){\n        //获取小鸟的动画组件，并停止动画\n        var animBird = this.bird.getComponent(cc.Animation);\n        animBird.stop();\n\n\n        // 把当前分数与最大分数比较\n        this.setScore();   \n\n        //关闭监听事件\n        this.node.off(cc.Node.EventType.TOUCH_START,this.touchFunction, this);\n\n        //停止所有动作，并重新加载界面\n        this.bird.stopAllActions();\n        cc.audioEngine.stop(this.current);\n\n        var callback = cc.callFunc(function(){\n            //显示重新开始\n            this.button.active = true;\n        }, this);\n\n        var sequence = cc.sequence(this.bird.spawn, callback);\n        this.bird.runAction(sequence);\n    },\n\n    setScore:function(){\n        this.scoreDisplay.node.active = false;\n        this.lastScore.string = this.score;\n        console.log(cc.sys.localStorage.getItem(\"bestScore\"))\n        if(this.score > cc.sys.localStorage.getItem(\"bestScore\")){     \n            cc.sys.localStorage.setItem(\"bestScore\", this.score);\n        }\n        if(cc.sys.localStorage.getItem(\"bestScore\")){\n            this.bestScore.string = cc.sys.localStorage.getItem(\"bestScore\");\n        }\n    },\n\n    update: function(dt) {\n        //未开始时小鸟的浮动\n        if(this.bird.isprepared == false){\n            this.birdFloat();\n        }\n\n        //隐藏标题，显示记分板\n        if(this.bird.isprepared == true){\n            this.title.active = false;\n        }\n        \n        //在游戏开始之后、结束之前，移动游戏中的柱子\n        if(this.bird.isprepared == true && this.isGameOver == false){\n            this.scoreDisplay.node.active = true;\n            this.groundMove();\n            this.pillarMove();\n        }\n\n        //游戏结束\n        if(this.isGameOverFun()){\n            this.isGameOver = true;\n            \n            if(this.firstTimeEnd == true){\n                this.gameOver();\n                this.firstTimeEnd = false;\n            }\n        }\n    },\n});\n"]}